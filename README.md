
# Flask-приложение для сокращения ссылок

Учебный проект для курсов web-разработчиков [dvmn](https://dvmn.org).  


## Установка
Понадобится установленный Python 3.8+ и git.

Клонируем репозиторий:
```bash
git@github.com:IlyaG96/link-shortener.git
```

Создайте виртуальное окружение:
```bash
cd link-shortener
python3 -m venv env
```

Активируйте виртуальное окружение и установите все необходимые пакеты.
```bash
source env/bin/activate
pip install -r requirements.txt
```
Возможно, потребуется обновить pip командой:
```shell
python3 -m pip install --upgrade pip
```
## Вероятные сценарии использования

### Протестировать сайт локально


<details>
<summary>Протестировать сервис локально</summary>

- Создайте файл `.env` в той же папке, что и `app_factory.py` или заполните прилагающийся `.env.example` и переименуйте его в `.env`:
```shell
* REDIS_HOST - публичный адрес базы данных Redis
* REDIS_PORT - порт БД Redis
* REDIS_PASSWORD - пароль БД Redis
* SECRET_KEY=mysecretkeyhehehe
```
SECRET_KEY - секретный ключ проекта Flask.  
- [Базу данный Redis можно создать здесь](https://redis.io/)
- Запустите приложение командой:

```shell
python app_factory.py
```
**Обязательно создайте базу данных [Redis](https://redis.io/) и убедитесь в правильности пароля, хоста и порта.**   

После запуска сайт будет доступен по [ссылке](http://127.0.0.1:5000).

Для пользователя доступен ~~ужасный~~ простейший UI, который позволяет создавать ссылки вида:
- http://127.0.0.1:5000/my-short-link (вместо my-short-link может быть любой латинский текст с цифрами и знаками "-")
- http://127.0.0.1:5000/Hjjsln24 - ссылка, созданная автоматически

</details>

### API

<details>

<summary>Примеры использования API</summary>

#### /api/custom

Метод  `/api/custom` применяется для того, чтобы создать сокращенную ссылку с удобным человекочитаемым названием:  
Пример:   

- `http://127.0.0.1:5000/api/custom?name=my-link-name&link=https://google.com`    

`name` - имя для ссылки

`link` - ссылка для сокращения 

Сохранит ссылку https://google.com в базу данных. После ссылка будет доступна по адресу:  

`http://127.0.0.1:5000/my-link-name`

#### /api/make-short

Метод  `/api/make-short` применяется для того, чтобы создать сокращенную ссылку:  
Пример:

- `http://127.0.0.1:5000/api/make-short?link=https://google.com`

`link` - ссылка для сокращения

Сохранит ссылку https://google.com в базу данных. После ссылка будет доступна по адресу:

`http://127.0.0.1:5000/my-link-name/05046f26`  

#### Статусы ответов:

`200 ОК` - в случае, если нет ошибок в API.  
`302 FOUND` - если ссылка существует и происходит переход по ней.  
`404 NOT FOUND` - в случае, если в API есть ошибка.  

</details>


### Тесты

<details>

<summary>Тестирование приложения</summary>

Перед запуском тестов убедитесь, что:
1) Интернет включен.
2) База данных Redis успешно создана.

Тесты проверяют стандартные сценарии использования API. В случае правильной настройки приложения, все 17 сценариев должны быть пройдены успешно. 
1) Смените директорию на `tests`
2) запустите тесты командой:
```shell
python pytest test_api.py
```
</details>

### config.py

Используется для настройки приложения. 
